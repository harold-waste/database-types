{"version":3,"sources":["../../src/utilities/generateClassTableTypeDocument.js"],"names":["generateClassTableTypeDeclarationBody","properties","sortedProperties","propertyDeclarations","column","nullable","colon","constraintType","push","name","_","upperFirst","replace","formatTypeName","refTableName","type","primary","join","columns","groupedProperties","typeDeclarations","typeNames","Object","keys","sort","typeName","typeProperties","typeDeclaration","tableName","importText"],"mappings":";;;;;;AAEA;;;;AAOA;;;;AAEA,MAAMA,wCAAyCC,UAAD,IAA0D;AACtG,QAAMC,mBAAmB,oBAAOD,UAAP,EAAmB,MAAnB,CAAzB;;AAEA,QAAME,uBAAuB,EAA7B;AAHsG;AAAA;AAAA;;AAAA;AAItG,yBAAqBD,gBAArB,8HAAuC;AAAA,YAA5BE,MAA4B;;AACrC,YAAMC,WAAWD,OAAOC,QAAP,GAAkB,qBAAlB,GAA0C,EAA3D;AACA,YAAMC,QAAQF,OAAOC,QAAP,GAAkB,KAAlB,GAA0B,IAAxC;AACA,UAAID,OAAOG,cAAP,KAA0B,aAA9B,EAA6C;AAC3CJ,6BAAqBK,IAArB,CAA2B,sBAAqBJ,OAAOK,IAAK,MAA5D;AACAN,6BAAqBK,IAArB,CAA0B,oBACtBE,iBAAEC,UAAF,CAAaD,iBAAEE,OAAF,CAAUF,iBAAEE,OAAF,CAAUR,OAAOK,IAAjB,EAAuB,KAAvB,EAA8B,EAA9B,CAAV,EAA6C,IAA7C,EAAmD,EAAnD,CAAb,CADsB,GAEtB,GAFsB,GAEhBL,OAAOS,cAAP,CAAsBT,OAAOU,YAA7B,EAA2CJ,gBAA3C,CAFgB,GAEgC,GAF1D;AAGAP,6BAAqBK,IAArB,CAA0B,aAA1B;AACAL,6BAAqBK,IAArB,CAA0B,cAAcJ,OAAOK,IAArB,GAA4BH,KAA5B,GAAoCF,OAAOW,IAA3C,GAAkDV,QAAlD,GAA6D,GAAvF;AACD,OAPD,MAOO;AACL,cAAMW,UAAWZ,OAAOG,cAAP,KAA0B,aAA3B,GAA4C,mBAA5C,GAAkE,EAAlF;AACAJ,6BAAqBK,IAArB,CAA0B,eAAcQ,OAAd,GAAuB,GAAjD;AACAb,6BAAqBK,IAArB,CAA0B,cAAcJ,OAAOK,IAArB,GAA4BH,KAA5B,GAAoCF,OAAOW,IAA3C,GAAkDV,QAAlD,GAA6D,GAAvF;AACD;AAEF;AApBqG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAsBtG,SAAOF,qBAAqBc,IAArB,CAA0B,IAA1B,CAAP;AACD,CAvBD;;kBA0BEC,OADa,IAEF;AACX,QAAMC,oBAAoB,qBAAQD,OAAR,EAAiB,UAAjB,CAA1B;;AAEA,QAAME,mBAAmB,EAAzB;;AAEA,QAAMC,YAAYC,OAAOC,IAAP,CAAYJ,iBAAZ,EAA+BK,IAA/B,EAAlB;;AALW;AAAA;AAAA;;AAAA;AAOX,0BAAuBH,SAAvB,mIAAkC;AAAA,YAAvBI,QAAuB;;AAChC,YAAMC,iBAAiBP,kBAAkBM,QAAlB,CAAvB;;AAEA,YAAME,kBAAmB;UACnBD,eAAe,CAAf,EAAkBE,SAAU;eACvBH,QAAS;EACtBzB,sCAAsC0B,cAAtC,CAAsD;GAHpD;;AAMAN,uBAAiBZ,IAAjB,CAAsBmB,eAAtB;AACD;AAjBU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAkBX,QAAME,aAAa,0DAAnB;AACA,SAAOA,aAAaT,iBAAiBH,IAAjB,CAAsB,IAAtB,CAApB;AACD,C","file":"generateClassTableTypeDocument.js","sourcesContent":["// @flow\n\nimport _, {\n  groupBy,\n  sortBy,\n} from 'lodash';\nimport type {\n  TypePropertyType\n} from '../types';\nimport { handler } from '../bin/commands/generate-types';\n\nconst generateClassTableTypeDeclarationBody = (properties: $ReadOnlyArray<TypePropertyType>): string => {\n  const sortedProperties = sortBy(properties, 'name');\n\n  const propertyDeclarations = [];\n  for (const column of sortedProperties) {\n    const nullable = column.nullable ? ' | null | undefined' : '';\n    const colon = column.nullable ? '?: ' : ': ';\n    if (column.constraintType === 'FOREIGN KEY') {\n      propertyDeclarations.push(`\\t@Column({ name: '${column.name}' })`);\n      propertyDeclarations.push('\\tpublic joined'\n        + _.upperFirst(_.replace(_.replace(column.name, 'Ids', ''), 'Id', ''))\n        + ':' + column.formatTypeName(column.refTableName, _) + ';');\n      propertyDeclarations.push('\\t@Column()');\n      propertyDeclarations.push('\\tpublic ' + column.name + colon + column.type + nullable + ';');\n    } else {\n      const primary = (column.constraintType === 'PRIMARY KEY') ? '{ primary: true }' : '';\n      propertyDeclarations.push('\\t@Column('+ primary +')');\n      propertyDeclarations.push('\\tpublic ' + column.name + colon + column.type + nullable + ';');\n    }\n    \n  }\n\n  return propertyDeclarations.join('\\n');\n};\n\nexport default (\n  columns: $ReadOnlyArray<TypePropertyType>\n): string => {\n  const groupedProperties = groupBy(columns, 'typeName');\n\n  const typeDeclarations = [];\n\n  const typeNames = Object.keys(groupedProperties).sort();\n\n  for (const typeName of typeNames) {\n    const typeProperties = groupedProperties[typeName];\n\n    const typeDeclaration = `\n@Table(\"${typeProperties[0].tableName}\")\nexport class ${typeName} {\n${generateClassTableTypeDeclarationBody(typeProperties)}\n};`;\n\n    typeDeclarations.push(typeDeclaration);\n  }\n  const importText = \"import { Column, Table } from '@wwwouter/typed-knex'; \\n\"\n  return importText + typeDeclarations.join('\\n');\n};\n"]}